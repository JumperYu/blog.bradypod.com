<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>html5俄罗斯方块-树懒博客-BradyPod's Blog</title>
  <meta name="description" content="树懒博客；BradyPod's Blog;89后，工作在广州；Java程序员。">
  <meta name="keywords" content="java, linux, shell, nginx, lua, mysql, memcached, redis">
  <meta name="author" content="bradypod">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="favicon.ico" type="image/ico" rel="icon">
  <link href="favicon.ico" type="image/ico" rel="shortcut icon">

  <link rel="canonical" href="http://blog.bradypod.com/">
  <link rel="stylesheet" href="/static/css/bootstrap.min.css" media="all">
  <link rel="stylesheet" href="/static/css/font-awesome.min.css" media="all">
  <link rel="stylesheet" href="/static/css/style.css" media="all">
  <link rel="stylesheet" href="/static/css/desert.css" media="all">
 </head>
<body onload="prettyPrint()">
	<div class="container">

    <header class="header">
      <div class="title"><a title="bradypod's blog" href="/">BradyPod's blog</a></div>
      <ul class="nav navbar-nav navbar-right visible-lg visible-md">
        <li>
          <form id="search-form" class="form-group has-success visible-lg" role="form">
            <input type="text" class="form-control input-sm" placeholder="Search" id="query" style="width: 110px;">
          </form>
        </li>
        <li><a href="https://github.com/JumperYu" title="我的github主页"><i class="icon-github"></i> github</a></li>
        <li><a href="http://weibo.com/javaserverfaces/home?wvr=5" title="我的微博主页"><i class="icon-pinterest-sign"></i> weibo</a></li>
        <li><a href="index.html" title="联系我"><i class="icon-phone"></i> telphone</a></li>
      </ul>
    </header>
    <div class="wrapper">
		<div class="row">
        <div class="col-md-12">
          <article class="news-item">
  		    <h1>利用html5的canvas制作俄罗斯方块小游戏</h1>
          <p><h3>上一篇，实践了<a href="/2015/01/21/snake.html" target="_blank">《html5贪吃蛇》</a></h3></p>
  		    </aritcle>
<div>
<pre class="prettyprint lang-javascript linenums">

</pre>
</div><!-- end pretty div -->
          
        <div id="myCanvas"><div>
         

        </div><!-- end col md 12 div -->
    </div><!-- end row -->
    </div><!-- end wrapper -->
    <footer class="footer text-center">
        <p>&copy; 2014-2016 <a href="/" target="_blank" title="89后，工作在广州；Java程序员">bradypod's blog</a>.

        <span style="float:right;"><a href="/about.html">关于</a></span>
    
        <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1254122988'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1254122988' type='text/javascript'%3E%3C/script%3E"));</script>
        </p>

        <div style="display: block;" id="toTop">
          <a href="#" title="火箭"><i class="icon-arrow-up"></i></a><a href="#footer" title="火箭"><i class="icon-arrow-down"></i></a>
        </div>
    </footer>
    </div><!-- end container -->

  <script type="text/javascript">
    var KeyCode = {
      LEFT : 37,
      UP : 38,
      RIGHT : 39,
      DOWN : 40
    };
    function Tetris(rows, cols, cellWidth, cellHeight) {
    this.ctx = null;
    this.shap = {
                Line : [[1,0,0,0], [1,0,0,0], [1,0,0,0], [1,0,0,0]], 
                Less : [[1,0,0,0], [1,1,1,0], [0,0,0,0], [0,0,0,0]],
                Zee : [[1,1,0,0], [0,1,1,0], [0,0,0,0], [0,0,0,0]],
                Tian : [[1,1,0,0], [1,1,0,0], [0,0,0,0], [0,0,0,0]],
                Tu : [[0,1,0,0], [1,1,1,0], [0,0,0,0], [0,0,0,0]]
    };
    this.grid = [];  // 所有格子状态
    this.current = [];        // 所有方块格子状态
    this.thread = null;       // 当前线程
    this.play = function() {
      if(this.check()) {
        clearInterval(this.thread);
      }// 检测
      this.ctx.clearRect(0, 0, 500, 500);
      for(var i = 0; i < this.current.length; i++) {
        for(var j = 0; j < this.current[i].length; j++) {
          if(this.current[i][j] == 1) {
            this.ctx.fillStyle = "rgb(255,165,0)";
            this.ctx.fillRect(j * cellHeight, i * cellWidth, cellWidth, cellHeight);
          }
        }
      }// --> end of draw this.current
      this.current.unshift([0,0,0,0]);
    };
    this.check = function() {
      len = this.current[this.current.length - 1].length ;
      if(len < 4 && len < cols)
        return true;
      else
        return false;
    };
    this.init = function () {
      // 初始化
      this.current = this.shap.Tu;
      var _div = document.getElementById("myCanvas");
      var _canvas = document.createElement("canvas");
      _div.appendChild(_canvas);
      _canvas.width = cols * cellWidth;
      _canvas.height = rows * cellHeight;
      _canvas.style.border = "1px solid black";
      this.ctx = _canvas.getContext("2d");
      this.ctx.beginPath();
      // 画横线
      for(var i = 1; i < rows; i++) {
        this.ctx.moveTo(0, cellHeight * i);
        this.ctx.lineTo(cellHeight * cols, cellHeight * i);
        // 初始化X轴
        this.grid.push(new Array());
        // 画竖线
        for(var j = 1; j < cols; j++) {
          this.ctx.moveTo(cellWidth * j, 0);
          this.ctx.lineTo(cellWidth * j, cellWidth * rows);
          // 初始化Y轴
          this.grid[i - 1][j - 1] = 0;
        }
      }
      this.ctx.closePath();
      this.ctx.strokeStyle = "#aaa";
      this.ctx.lineWidth = 0.3;
      this.ctx.stroke();
    };//-- end init canvas
    this.move = function (code) {
      if(code == KeyCode.LEFT) {
        for(var i = 0; i < this.current.length; i++) {
            this.current[i].shift();
        }// --> end of turn right
      } else if (code == KeyCode.RIGHT) {
        for(var i = 0; i < this.current.length; i++) {
            this.current[i].unshift(0);
        }// --> end of turn right
      }
    };
    this.log = function (msg) {
      console.log(msg);
    }
   }
    
    /*入口*/
   (function(){
      /*开始游戏*/
      var tetris = new Tetris(30, 30, 10, 10);
      tetris.init();
      this.thread = setInterval(function() {
        tetris.play();
      }, 500);
      // 监听键盘
      document.onkeyup = function(event) { 
        tetris.move(event.keyCode);
      }
    })();
  </script>

	<script src="/static/js/jquery.min.js"></script>
	<script src="/static/js/bootstrap.min.js"></script>
	<script src="/static/js/prettify.js"></script>
	<script src="/static/js/core.js"></script>
</body>
</html>